<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Guide stratégique League of Legends : Builds, Runes et Conseils de gameplay pour maîtriser votre champion.">
    
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self'; 
        script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline'; 
        style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; 
        font-src https://fonts.gstatic.com; 
        img-src 'self' https://ddragon.leagueoflegends.com data:; 
        connect-src 'self' https://ddragon.leagueoflegends.com https://cdn.jsdelivr.net data:;
    ">

    <title>Guide Champion — Summoner's Hub</title>
    
    <link rel="preconnect" href="https://ddragon.leagueoflegends.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Cinzel:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style type="text/tailwindcss">
        @theme {
            --color-lol-dark: #091428;
            --color-lol-darker: #0a1428;
            --color-lol-gold: #C8AA6E;
            --color-lol-gold-light: #F0E6D2;
            --color-lol-blue: #0AC8B9;
            --color-lol-blue-dim: #005A82;
            --font-display: 'Cinzel', serif;
            --font-body: 'Inter', sans-serif;
        }
        .spell-key {
            position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            background: #091428; border: 1px solid #C8AA6E; color: #C8AA6E;
            width: 20px; height: 20px; font-size: 10px; display: flex; 
            align-items: center; justify-content: center; font-weight: bold;
        }
        .rune-icon { 
            transition: all 0.2s ease; cursor: help; filter: grayscale(0.4) opacity(0.8);
        }
        .rune-icon:hover { 
            filter: grayscale(0) opacity(1) drop-shadow(0 0 8px #C8AA6E); transform: scale(1.1); 
        }
        .rune-keystone { filter: drop-shadow(0 0 5px rgba(200, 170, 110, 0.3)); }
        
        .mask-image-gradient {
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }
    </style>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-lol-dark text-lol-gold-light font-body">

    <div id="runeTooltip" class="fixed hidden z-[100] bg-[#050a12]/95 backdrop-blur-md border border-lol-gold rounded-md p-4 w-72 shadow-2xl pointer-events-none transition-opacity duration-200">
        <h4 id="rtTitle" class="text-lol-gold font-display font-bold text-lg mb-1"></h4>
        <p id="rtDesc" class="text-xs text-gray-300 leading-relaxed"></p>
    </div>

    <header class="fixed top-0 w-full z-50 bg-lol-dark/90 backdrop-blur-md border-b border-lol-gold/20 shadow-lg">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 hover:text-lol-blue transition-colors group">
                <span class="text-2xl group-hover:-translate-x-1 transition-transform">←</span> 
                <span class="font-bold uppercase tracking-widest text-sm md:text-base">Retour</span>
            </a>
            <h1 class="text-xl font-display font-bold text-lol-gold">Guide Stratégique</h1>
        </div>
    </header>

    <section id="heroBanner" class="relative h-[50vh] flex items-end pb-12 mt-20 overflow-hidden">
        <div class="absolute inset-0 z-0">
            <img id="heroBg" src="" alt="" class="w-full h-full object-cover object-top opacity-50 mask-image-gradient" crossorigin="anonymous">
            <div class="absolute inset-0 bg-gradient-to-t from-lol-dark via-lol-dark/40 to-transparent"></div>
        </div>

        <div class="relative z-10 max-w-7xl mx-auto px-6 w-full flex items-end gap-6">
            <img id="champIcon" src="" alt="Icône Champion" width="128" height="128" class="w-24 h-24 md:w-32 md:h-32 border-2 border-lol-gold shadow-2xl hidden md:block rounded-lg bg-lol-darker" crossorigin="anonymous">
            <div>
                <h2 id="champName" class="text-5xl md:text-7xl font-display font-bold text-white drop-shadow-lg">Chargement...</h2>
                <div class="flex items-center gap-4 mt-2">
                    <p id="champTitle" class="text-xl text-lol-blue uppercase tracking-widest font-bold"></p>
                    <div id="champTags" class="flex gap-2"></div>
                </div>
            </div>
        </div>
    </section>

    <main class="max-w-7xl mx-auto px-6 py-12 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-12">
            <section>
                <h3 class="text-2xl font-display text-lol-gold mb-6 border-b border-lol-gold/20 pb-2">Kit de Sorts</h3>
                <div class="flex flex-wrap gap-6 justify-center md:justify-start" id="spellsContainer"></div>
                <div id="spellDescBox" class="mt-6 p-4 bg-lol-darker border border-lol-gold/30 rounded min-h-[100px] text-gray-200 text-sm leading-relaxed">
                    Survolez une compétence pour voir les détails.
                </div>
            </section>

            <section class="bg-lol-darker p-6 rounded-lg border border-lol-gold/10">
                <h3 class="text-xl font-display text-white mb-4">Gameplay & Stratégie</h3>
                <div id="gameplayContent" class="space-y-4 text-gray-200 leading-relaxed"></div>
            </section>
        </div>

        <div class="lg:col-span-1 space-y-8">
            <div class="bg-[#050a12] border border-lol-gold p-6 rounded-xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-2 bg-lol-gold text-lol-dark font-bold text-xs uppercase z-10">
                    Adapté à la Classe
                </div>
                
                <h3 class="text-xl font-display text-white mb-6 relative z-10">Arbre de Runes</h3>
                
                <div class="flex justify-between relative z-10 px-2">
                    <div class="flex flex-col items-center gap-3 w-1/2 border-r border-gray-700">
                        <div class="text-[10px] uppercase text-lol-blue tracking-widest mb-1 font-bold">
                            Primaire
                        </div>
                        <div id="primaryRunes" class="flex flex-col items-center gap-3"></div>
                    </div>

                    <div class="flex flex-col items-center gap-3 w-1/2">
                        <div class="text-[10px] uppercase text-gray-300 tracking-widest mb-1 font-bold">
                            Secondaire
                        </div>
                        <div id="secondaryRunes" class="flex flex-col items-center gap-4 mt-2"></div>
                    </div>
                </div>
                <div class="absolute -bottom-10 -right-10 w-40 h-40 bg-lol-gold/5 rounded-full blur-3xl"></div>
            </div>

            <div class="bg-lol-darker border border-lol-gold/30 p-6 rounded-xl">
                <h3 class="text-xl font-display text-white mb-4">Objets Essentiels</h3>
                <div id="itemsContainer" class="space-y-6"></div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const champId = urlParams.get('id');
            if (!champId) { window.location.href = 'index.html'; return; }

            const tooltip = document.getElementById('runeTooltip');
            const ttTitle = document.getElementById('rtTitle');
            const ttDesc = document.getElementById('rtDesc');

            const showTooltip = (e, name, desc) => {
                ttTitle.textContent = name;
                ttDesc.innerHTML = desc;
                tooltip.classList.remove('hidden');
                moveTooltip(e);
            };
            const moveTooltip = (e) => {
                const x = e.clientX;
                const y = e.clientY;
                tooltip.style.left = `${Math.min(x + 15, window.innerWidth - 300)}px`;
                tooltip.style.top = `${y + 15}px`;
            };
            const hideTooltip = () => { tooltip.classList.add('hidden'); };

            try {
                const vRes = await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
                const vData = await vRes.json();
                const version = vData[0];

                const cRes = await fetch(`https://ddragon.leagueoflegends.com/cdn/${version}/data/fr_FR/champion/${champId}.json`);
                const cData = await cRes.json();
                const champ = cData.data[champId];

                const rRes = await fetch(`https://ddragon.leagueoflegends.com/cdn/${version}/data/fr_FR/runesReforged.json`);
                const runesData = await rRes.json();

                document.title = `Guide ${champ.name} S14 - ${champ.title}`;
                document.querySelector('meta[name="description"]').setAttribute("content", 
                    `Guide complet pour ${champ.name} (${champ.title}) : Runes, Items, Sorts et Gameplay pour la saison actuelle.`);

                document.getElementById('champName').textContent = champ.name;
                document.getElementById('champTitle').textContent = champ.title;
                
                const heroBg = document.getElementById('heroBg');
                heroBg.src = `https://ddragon.leagueoflegends.com/cdn/img/champion/splash/${champ.id}_0.jpg`;
                heroBg.alt = `Splash art de ${champ.name}`;
                
                const iconImg = document.getElementById('champIcon');
                iconImg.src = `https://ddragon.leagueoflegends.com/cdn/${version}/img/champion/${champ.image.full}`;
                iconImg.alt = `Icône de ${champ.name}`;
                
                const tagsContainer = document.getElementById('champTags');
                champ.tags.forEach(tag => {
                    tagsContainer.innerHTML += `<span class="px-2 py-1 bg-lol-blue/20 border border-lol-blue text-lol-blue text-xs font-bold rounded uppercase">${tag}</span>`;
                });

                const spellsContainer = document.getElementById('spellsContainer');
                const descBox = document.getElementById('spellDescBox');
                const spellKeys = ['A', 'Z', 'E', 'R'];
                
                const createSpellIcon = (img, key, name, desc) => {
                    const div = document.createElement('div');
                    div.className = "relative group cursor-pointer";
                    div.innerHTML = `
                        <div class="w-16 h-16 border border-gray-600 rounded bg-cover group-hover:border-lol-gold transition-all overflow-hidden relative">
                            <img src="${img}" alt="Sort ${name}" crossorigin="anonymous" loading="lazy" class="w-full h-full object-cover">
                        </div>
                        <div class="spell-key">${key}</div>
                    `;
                    div.addEventListener('mouseenter', () => descBox.innerHTML = `<strong class="text-lol-gold block mb-1 text-lg">${name}</strong><p class="text-gray-200">${desc}</p>`);
                    return div;
                }

                spellsContainer.appendChild(createSpellIcon(`https://ddragon.leagueoflegends.com/cdn/${version}/img/passive/${champ.passive.image.full}`, 'P', champ.passive.name, champ.passive.description));
                champ.spells.forEach((s, i) => spellsContainer.appendChild(createSpellIcon(`https://ddragon.leagueoflegends.com/cdn/${version}/img/spell/${s.image.full}`, spellKeys[i], s.name, s.description)));

                const mainTag = champ.tags[0];
                let runeSet = { primary: 8000, sub: 8100, keyIndex: 0 }; 
                if(mainTag === 'Mage') runeSet = { primary: 8200, sub: 8300, keyIndex: 1 };
                else if(mainTag === 'Assassin') runeSet = { primary: 8100, sub: 8000, keyIndex: 0 };
                else if(mainTag === 'Tank') runeSet = { primary: 8400, sub: 8000, keyIndex: 0 };
                else if(mainTag === 'Marksman') runeSet = { primary: 8000, sub: 8100, keyIndex: 0 };
                else if(mainTag === 'Fighter') runeSet = { primary: 8000, sub: 8400, keyIndex: 2 };
                else runeSet = { primary: 8300, sub: 8200, keyIndex: 0 };

                const primaryTree = runesData.find(r => r.id === runeSet.primary);
                const subTree = runesData.find(r => r.id === runeSet.sub);

                const createRuneEl = (imgUrl, name, desc, sizeClass, isKeystone = false) => {
                    const img = document.createElement('img');
                    img.src = `https://ddragon.leagueoflegends.com/cdn/img/${imgUrl}`;
                    img.className = `rune-icon ${sizeClass} ${isKeystone ? 'rune-keystone' : ''}`;
                    img.crossOrigin = "anonymous"; 
                    img.alt = `Rune ${name}`;
                    img.addEventListener('mouseenter', (e) => showTooltip(e, name, desc));
                    img.addEventListener('mousemove', moveTooltip);
                    img.addEventListener('mouseleave', hideTooltip);
                    return img;
                };

                const pContainer = document.getElementById('primaryRunes');
                const sContainer = document.getElementById('secondaryRunes');
                
                pContainer.appendChild(createRuneEl(primaryTree.icon, primaryTree.name, "Voie Principale", "w-6 h-6 mb-2 grayscale opacity-50"));
                pContainer.appendChild(createRuneEl(primaryTree.slots[0].runes[runeSet.keyIndex].icon, primaryTree.slots[0].runes[runeSet.keyIndex].name, primaryTree.slots[0].runes[runeSet.keyIndex].longDesc, "w-14 h-14", true));
                [1,2,3].forEach(i => {
                    const r = primaryTree.slots[i].runes[0];
                    pContainer.appendChild(createRuneEl(r.icon, r.name, r.longDesc, "w-9 h-9"));
                });

                sContainer.appendChild(createRuneEl(subTree.icon, subTree.name, "Voie Secondaire", "w-6 h-6 mb-2 grayscale opacity-50"));
                [1,2].forEach(i => {
                    const r = subTree.slots[i].runes[0];
                    sContainer.appendChild(createRuneEl(r.icon, r.name, r.longDesc, "w-8 h-8"));
                });

                const itemsContainer = document.getElementById('itemsContainer');
                itemsContainer.innerHTML = '';

                const fallbackItems = {
                    'Mage': [{id:'1056'}, {id:'3020'}, {id:'6653'}, {id:'3089'}, {id:'3135'}],
                    'Marksman': [{id:'1055'}, {id:'3006'}, {id:'3031'}, {id:'3094'}, {id:'3036'}],
                    'Assassin': [{id:'1055'}, {id:'3158'}, {id:'6691'}, {id:'3142'}, {id:'3179'}],
                    'Tank': [{id:'1054'}, {id:'3047'}, {id:'3068'}, {id:'3075'}, {id:'3109'}],
                    'Fighter': [{id:'1055'}, {id:'3111'}, {id:'3078'}, {id:'3053'}, {id:'6333'}],
                    'Support': [{id:'3850'}, {id:'3158'}, {id:'3190'}, {id:'3107'}, {id:'3222'}]
                };

                let itemsToShow = [];
                const recData = champ.recommended.find(r => r.map === "11" || r.map === "SR");

                if (recData && recData.blocks.length > 0) {
                    const coreBlock = recData.blocks.find(b => b.type.includes('core') || b.type.includes('essential')) || recData.blocks[0];
                    itemsToShow = coreBlock.items;
                } else {
                    const classItems = fallbackItems[mainTag] || fallbackItems['Fighter'];
                    itemsToShow = classItems.map(i => ({ id: i.id }));
                }

                let html = `<div><p class="text-xs text-lol-blue uppercase font-bold mb-4">Build Principal</p><div class="flex flex-wrap gap-4">`;
                itemsToShow.slice(0, 6).forEach(item => {
                    html += `
                        <div class="relative group">
                            <img src="https://ddragon.leagueoflegends.com/cdn/${version}/img/item/${item.id}.png" 
                                 class="w-12 h-12 border border-gray-600 rounded bg-gray-900 group-hover:border-lol-gold group-hover:scale-110 transition-all cursor-pointer"
                                 title="Objet ID: ${item.id}"
                                 alt="Objet ${item.id}"
                                 width="48" height="48"
                                 crossorigin="anonymous"
                                 loading="lazy">
                        </div>`;
                });
                html += `</div></div>`;
                itemsContainer.innerHTML = html;

                const gameplayBox = document.getElementById('gameplayContent');
                const roleAdvice = {
                     'Assassin': `<p><strong class="text-lol-gold">Rôle :</strong> Éliminez les cibles fragiles. Ne lancez pas le combat frontalement.</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Cherchez les flancs. Utilisez la vision pour surprendre l'ennemi dans la jungle.</p>`,
                    'Fighter': `<p><strong class="text-lol-gold">Rôle :</strong> Ligne de front. Encaissez et infligez des dégâts sur la durée.</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Le Split-push est une bonne option. Attirez la pression sur une voie latérale.</p>`,
                    'Mage': `<p><strong class="text-lol-gold">Rôle :</strong> Dégâts de zone et contrôle. Restez derrière la frontline.</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Nettoyez les vagues rapidement (Waveclear) pour sécuriser la priorité mid.</p>`,
                    'Marksman': `<p><strong class="text-lol-gold">Rôle :</strong> DPS Constant. La survie est prioritaire.</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Ne jamais face-check les buissons. Restez collé à votre support.</p>`,
                    'Tank': `<p><strong class="text-lol-gold">Rôle :</strong> Engage et Protection (Peel).</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Soyez toujours présent 30s avant les objectifs (Dragon/Baron) pour prendre la vision.</p>`,
                    'Support': `<p><strong class="text-lol-gold">Rôle :</strong> Vision et Protection.</p><p class="mt-2"><strong class="text-lol-gold">Macro :</strong> Posez des wards profondes. Roamez mid si votre ADC est en sécurité.</p>`
                };
                gameplayBox.innerHTML = roleAdvice[mainTag] || roleAdvice['Fighter'];

            } catch (error) {
                console.error("Erreur", error);
            }
        });
    </script>
</body>
</html>